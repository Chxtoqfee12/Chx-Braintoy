-- ===== Services =====
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local PhysicsService = game:GetService("PhysicsService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- ===== CollisionGroup =====
task.defer(function()
	if not pcall(function() PhysicsService:CreateCollisionGroup("Float") end) then end
	PhysicsService:CollisionGroupSetCollidable("Float", "Default", false) -- ไม่ชนสิ่งก่อสร้าง
	PhysicsService:CollisionGroupSetCollidable("Float", "Player", true)  -- ยังชน Player ได้
end)

-- ===== Settings =====
local FLOAT_HEIGHT = 100   -- ความสูงที่จะลอยขึ้น
local RISE_TIME = 5        -- เวลาในการลอยขึ้น
local OFFSET_BELOW = 3     -- สร้างแผ่นใต้เท้าเล็กน้อย

-- ===== Function Float =====
local function spawnLift()
	local char = player.Character
	if not char then return end
	local root = char:FindFirstChild("HumanoidRootPart")
	if not root then return end

	-- สร้างแผ่น
	local floatPart = Instance.new("Part")
	floatPart.Size = Vector3.new(15, 2, 15)
	floatPart.Anchored = false
	floatPart.CanCollide = true
	floatPart.Position = root.Position - Vector3.new(0, OFFSET_BELOW, 0)
	floatPart.Rotation = Vector3.new(0,0,0)
	floatPart.Name = "FloatPart"
	floatPart.Parent = workspace

	-- จัดกลุ่ม Collision
	PhysicsService:SetPartCollisionGroup(floatPart, "Float")

	-- BodyMover
	local bp = Instance.new("BodyPosition")
	bp.MaxForce = Vector3.new(1e6,1e6,1e6)
	bp.P = 5000
	bp.D = 100
	bp.Position = floatPart.Position
	bp.Parent = floatPart

	local bg = Instance.new("BodyGyro")
	bg.MaxTorque = Vector3.new(1e6,1e6,1e6)
	bg.P = 5000
	bg.CFrame = CFrame.new(floatPart.Position)
	bg.Parent = floatPart

	-- Animate ลอยขึ้น
	local startTime = tick()
	local startPos = floatPart.Position
	local endPos = startPos + Vector3.new(0, FLOAT_HEIGHT, 0)

	local conn
	conn = RunService.Heartbeat:Connect(function()
		local alpha = math.clamp((tick() - startTime)/RISE_TIME, 0, 1)
		bp.Position = startPos:Lerp(endPos, alpha)
		bg.CFrame = CFrame.new(bp.Position)

		if alpha >= 1 then
			conn:Disconnect()
			bp:Destroy()
			bg:Destroy()
		end
	end)

	-- ทำลายตัวเองหลัง 5 วิ
	task.delay(5, function()
		if floatPart then
			floatPart:Destroy()
		end
	end)
end

-- ===== Create UI ONCE =====
if not playerGui:FindFirstChild("FloatUI") then
	local screenGui = Instance.new("ScreenGui")
	screenGui.Name = "FloatUI"
	screenGui.ResetOnSpawn = false -- ไม่หายเวลา Respawn
	screenGui.Parent = playerGui

	local mainFrame = Instance.new("Frame")
	mainFrame.Size = UDim2.new(0, 160, 0, 60)
	mainFrame.AnchorPoint = Vector2.new(1,0)
	mainFrame.Position = UDim2.new(1, -100, 0, 50)
	mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
	mainFrame.Active = true
	mainFrame.Parent = screenGui
	Instance.new("UICorner", mainFrame).CornerRadius = UDim.new(0, 15)

	-- กรอบสายรุ้ง
	local stroke = Instance.new("UIStroke")
	stroke.Thickness = 3
	stroke.Parent = mainFrame
	task.spawn(function()
		while screenGui.Parent do
			for i = 0, 1, 0.01 do
				stroke.Color = Color3.fromHSV(i, 1, 1)
				task.wait(0.05)
			end
		end
	end)

	local floatBtn = Instance.new("TextButton")
	floatBtn.Size = UDim2.new(1, -20, 1, -20)
	floatBtn.Position = UDim2.new(0, 10, 0, 10)
	floatBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
	floatBtn.Text = "Float (F)"
	floatBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
	floatBtn.Font = Enum.Font.GothamBold
	floatBtn.TextSize = 18
	floatBtn.Parent = mainFrame
	Instance.new("UICorner", floatBtn).CornerRadius = UDim.new(0, 10)

	-- Drag Anywhere
	local dragging, dragStart, startPos
	local function update(input)
		local delta = input.Position - dragStart
		mainFrame.Position = UDim2.new(
			startPos.X.Scale, startPos.X.Offset + delta.X,
			startPos.Y.Scale, startPos.Y.Offset + delta.Y
		)
	end

	mainFrame.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = mainFrame.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)

	UserInputService.InputChanged:Connect(function(input)
		if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
			update(input)
		end
	end)

	-- Connect Button & Hotkey
	floatBtn.MouseButton1Click:Connect(spawnLift)
	UserInputService.InputBegan:Connect(function(input, gameProcessed)
		if gameProcessed then return end
		if input.UserInputType == Enum.UserInputType.Keyboard and input.KeyCode == Enum.KeyCode.F then
			spawnLift()
		end
	end)
end
