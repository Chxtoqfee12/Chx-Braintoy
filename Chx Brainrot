-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local UserInputService = game:GetService("UserInputService")
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- ===== UI =====
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "FloatUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = playerGui

-- Frame หลัก
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 220, 0, 280)
mainFrame.Position = UDim2.new(0.05, 0, 0.25, 0)
mainFrame.BackgroundColor3 = Color3.fromRGB(30,30,30)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui

local uiCorner = Instance.new("UICorner")
uiCorner.CornerRadius = UDim.new(0,20)
uiCorner.Parent = mainFrame

-- Rainbow border
local stroke = Instance.new("UIStroke")
stroke.Thickness = 4
stroke.Parent = mainFrame
local colors = {
	Color3.fromRGB(255,0,0),
	Color3.fromRGB(255,127,0),
	Color3.fromRGB(255,255,0),
	Color3.fromRGB(0,255,0),
	Color3.fromRGB(0,0,255),
	Color3.fromRGB(75,0,130),
	Color3.fromRGB(148,0,211)
}
spawn(function()
	local t=0
	while true do
		t = t+0.01
		if t>1 then t=0 end
		local index1 = math.floor(t*#colors)+1
		local index2 = index1+1
		if index2>#colors then index2=1 end
		local lerpT = (t*#colors)%1
		stroke.Color = colors[index1]:Lerp(colors[index2], lerpT)
		wait(0.03)
	end
end)

-- Title
local titleBar = Instance.new("Frame")
titleBar.Size = UDim2.new(1,0,0,30)
titleBar.BackgroundTransparency = 1
titleBar.Parent = mainFrame

local titleText = Instance.new("TextLabel")
titleText.Size = UDim2.new(1,-10,1,0)
titleText.Position = UDim2.new(0,5,0,0)
titleText.BackgroundTransparency = 1
titleText.Text = "CHX Brainrot"
titleText.Font = Enum.Font.GothamBold
titleText.TextSize = 18
titleText.TextColor3 = Color3.fromRGB(255,255,255)
titleText.TextXAlignment = Enum.TextXAlignment.Left
titleText.Parent = titleBar

-- Close button
local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.new(0,30,0,30)
closeBtn.Position = UDim2.new(1,-5,0,0)
closeBtn.AnchorPoint = Vector2.new(1,0)
closeBtn.BackgroundColor3 = Color3.fromRGB(200,50,50)
closeBtn.TextColor3 = Color3.fromRGB(255,255,255)
closeBtn.Text = "X"
closeBtn.Font = Enum.Font.GothamBold
closeBtn.TextSize = 16
closeBtn.Parent = titleBar
Instance.new("UICorner", closeBtn).CornerRadius = UDim.new(0,15)

-- ===== ปุ่ม Float =====
local floatBtn = Instance.new("TextButton")
floatBtn.Size = UDim2.new(0.9,-10,0,35)
floatBtn.Position = UDim2.new(0,10,0,40)
floatBtn.BackgroundColor3 = Color3.fromRGB(50,50,50)
floatBtn.TextColor3 = Color3.fromRGB(255,255,255)
floatBtn.Text = "Float Off"
floatBtn.Font = Enum.Font.GothamBold
floatBtn.TextSize = 16
floatBtn.Parent = mainFrame
Instance.new("UICorner", floatBtn).CornerRadius = UDim.new(0,12)

-- ===== ปุ่ม Auto Laser =====
local autoLaserBtn = Instance.new("TextButton")
autoLaserBtn.Size = UDim2.new(0.9,-10,0,35)
autoLaserBtn.Position = UDim2.new(0,10,0,85)
autoLaserBtn.BackgroundColor3 = Color3.fromRGB(70,70,70)
autoLaserBtn.TextColor3 = Color3.fromRGB(255,255,255)
autoLaserBtn.Text = "Auto Laser OFF"
autoLaserBtn.Font = Enum.Font.GothamBold
autoLaserBtn.TextSize = 16
autoLaserBtn.Parent = mainFrame
Instance.new("UICorner", autoLaserBtn).CornerRadius = UDim.new(0,12)

-- ===== ปุ่ม Run Function =====
local functionBtn = Instance.new("TextButton")
functionBtn.Size = UDim2.new(0.9,-10,0,35)
functionBtn.Position = UDim2.new(0,10,0,130)
functionBtn.BackgroundColor3 = Color3.fromRGB(80,80,80)
functionBtn.TextColor3 = Color3.fromRGB(255,255,255)
functionBtn.Text = "Run Function"
functionBtn.Font = Enum.Font.GothamBold
functionBtn.TextSize = 16
functionBtn.Parent = mainFrame
Instance.new("UICorner", functionBtn).CornerRadius = UDim.new(0,12)

-- ===== ปุ่ม Hop Server =====
local hopBtn = Instance.new("TextButton")
hopBtn.Size = UDim2.new(0.9,-10,0,35)
hopBtn.Position = UDim2.new(0,10,0,175)
hopBtn.BackgroundColor3 = Color3.fromRGB(50,50,50)
hopBtn.TextColor3 = Color3.fromRGB(255,255,255)
hopBtn.Text = "Hop Server"
hopBtn.Font = Enum.Font.GothamBold
hopBtn.TextSize = 16
hopBtn.Parent = mainFrame
Instance.new("UICorner", hopBtn).CornerRadius = UDim.new(0,12)

-- ===== ปุ่ม Auto Run แยกด้านล่าง =====
local autoRunBtn = Instance.new("TextButton")
autoRunBtn.Size = UDim2.new(0.9,-10,0,35)
autoRunBtn.Position = UDim2.new(0,10,0,220)
autoRunBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
autoRunBtn.TextColor3 = Color3.fromRGB(255,255,255)
autoRunBtn.Text = "Auto Run OFF"
autoRunBtn.Font = Enum.Font.GothamBold
autoRunBtn.TextSize = 16
autoRunBtn.Parent = mainFrame
Instance.new("UICorner", autoRunBtn).CornerRadius = UDim.new(0,12)

-- ===== ตัวแปร Float =====
local Floating = false
local FloatPart, FloatHeight = nil, -2
local FloatConn, char, root

local function updateCharacter()
	char = player.Character
	if char then
		root = char:WaitForChild("HumanoidRootPart")
	end
end
updateCharacter()
player.CharacterAdded:Connect(updateCharacter)

function enableFloat()
	if Floating then return end
	if not root then updateCharacter() end
	Floating = true
	floatBtn.Text = "Float On"

	FloatPart = Instance.new("Part")
	FloatPart.Size = Vector3.new(3,0.2,3)
	FloatPart.Anchored = true
	FloatPart.Transparency = 1
	FloatPart.Parent = workspace
	Instance.new("CylinderHandleAdornment", FloatPart)

	FloatConn = RunService.Heartbeat:Connect(function()
		if FloatPart and root then
			FloatPart.CFrame = CFrame.new(root.Position.X, root.Position.Y+FloatHeight, root.Position.Z)
		end
	end)
end

function disableFloat()
	if not Floating then return end
	Floating = false
	floatBtn.Text = "Float Off"
	if FloatConn then FloatConn:Disconnect() FloatConn=nil end
	if FloatPart then FloatPart:Destroy() FloatPart=nil end
end

-- ===== Drag Function =====
local dragging=false
local dragInput, dragStart, startPos
local function update(input)
	local delta=input.Position-dragStart
	mainFrame.Position = UDim2.new(
		startPos.X.Scale,
		startPos.X.Offset+delta.X,
		startPos.Y.Scale,
		startPos.Y.Offset+delta.Y
	)
end
titleBar.InputBegan:Connect(function(input)
	if input.UserInputType==Enum.UserInputType.MouseButton1 or input.UserInputType==Enum.UserInputType.Touch then
		dragging=true
		dragStart=input.Position
		startPos=mainFrame.Position
		input.Changed:Connect(function()
			if input.UserInputState==Enum.UserInputState.End then dragging=false end
		end)
	end
end)
titleBar.InputChanged:Connect(function(input)
	if input.UserInputType==Enum.UserInputType.MouseMovement or input.UserInputType==Enum.UserInputType.Touch then
		dragInput=input
	end
end)
UserInputService.InputChanged:Connect(function(input)
	if input==dragInput and dragging then update(input) end
end)

-- ===== ปุ่มกด =====
floatBtn.MouseButton1Click:Connect(function()
	if Floating then disableFloat() else enableFloat() end
end)

-- ===== Auto Laser Logic =====
local AutoLaser = false
local LaserDistance = 60
local Net = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("Net")
local Remote = Net:WaitForChild("RE/UseItem")
local PlayerMouse = require(ReplicatedStorage.Packages.PlayerMouse)

local function getRoot()
	local char = player.Character
	if char then return char:FindFirstChild("HumanoidRootPart") end
end

local function equipLaser()
	local backpack = player:WaitForChild("Backpack")
	local character = player.Character
	local humanoid = character:FindFirstChild("Humanoid")
	local laserTool = backpack:FindFirstChild("Laser Cape") or character:FindFirstChild("Laser Cape")
	if laserTool and humanoid then
		if laserTool.Parent ~= character then
			humanoid:EquipTool(laserTool)
			RunService.RenderStepped:Wait()
		end
		return laserTool
	end
	return nil
end

local function unequipLaser()
	local character = player.Character
	local backpack = player:WaitForChild("Backpack")
	local laserTool = character:FindFirstChild("Laser Cape")
	if laserTool then laserTool.Parent=backpack end
end

autoLaserBtn.MouseButton1Click:Connect(function()
	AutoLaser = not AutoLaser
	autoLaserBtn.Text = "Auto Laser "..(AutoLaser and "ON" or "OFF")
	if not AutoLaser then unequipLaser() end
end)

-- ===== ปุ่ม Function + Auto Run =====
local AutoRunFunction = false
if getgenv().AutoRunFunctionState ~= nil then
	AutoRunFunction = getgenv().AutoRunFunctionState
	autoRunBtn.Text = "Auto Run "..(AutoRunFunction and "ON" or "OFF")
end

local function loadFunction()
	local url = "https://raw.githubusercontent.com/Chxtoqfee12/Chx-Braintoy/refs/heads/main/src%20function"
	local success, funcOrErr = pcall(function()
		return loadstring(game:HttpGet(url))()
	end)
	if not success then
		warn("Failed to load function:", funcOrErr)
	end
end

functionBtn.MouseButton1Click:Connect(function()
	loadFunction()
end)

autoRunBtn.MouseButton1Click:Connect(function()
	AutoRunFunction = not AutoRunFunction
	autoRunBtn.Text = "Auto Run "..(AutoRunFunction and "ON" or "OFF")
	getgenv().AutoRunFunctionState = AutoRunFunction
	if AutoRunFunction then
		loadFunction()
	end
end)

if AutoRunFunction then
	loadFunction()
end

-- ===== Hop Server =====
hopBtn.MouseButton1Click:Connect(function()
	getgenv().ALLOWED_PLACE_ID = 109983668079237
	getgenv().RETRY_DELAY = 2
	getgenv().MIN_PLAYERS = 2
	getgenv().MAX_PLAYERS = 7
	getgenv().CHECK_COOLDOWN = 5
	getgenv().SOUND_ID = 91907916191505
	getgenv().MODEL_SEARCH_SETTINGS = {}
	loadstring(game:HttpGet("https://raw.githubusercontent.com/Chxtoqfee12/Chx-Braintoy/refs/heads/main/src%20hop%20server"))()
end)

-- ===== Close cleanup =====
closeBtn.MouseButton1Click:Connect(function()
	AutoLaser=false
	autoLaserBtn.Text="Auto Laser OFF"
	unequipLaser()
	disableFloat()
	screenGui:Destroy()
end)

-- ===== Main Auto Laser loop =====
spawn(function()
	while true do
		if AutoLaser then
			local root = getRoot()
			if root then
				local myPos=root.Position
				local laserTool=equipLaser()
				if laserTool then
					for _, targetPlayer in pairs(Players:GetPlayers()) do
						if targetPlayer~=player and targetPlayer.Character and targetPlayer.Character:FindFirstChild("UpperTorso") then
							local targetPart=targetPlayer.Character.UpperTorso
							if (myPos-targetPart.Position).Magnitude<=LaserDistance then
								laserTool:Activate()
								local args={targetPart.Position,targetPart}
								Remote:FireServer(unpack(args))
							end
						end
					end
				end
			end
		end
		wait(0.01)
	end
end)
